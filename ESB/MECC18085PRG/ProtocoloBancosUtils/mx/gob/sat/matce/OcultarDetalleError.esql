BROKER SCHEMA mx.gob.sat.matce

/*
*
* Autor: Oscar Daniel Jiménez Gutiérrez - Softtek
* Fecha de creación: 17 Enero 2018 Version: 1.0
*/


CREATE COMPUTE MODULE OcultarDetalleError
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
		IF NOT EXISTS(Environment.DetalleTransaccion[]) AND EXISTS(InputRoot.XMLNSC.Error.DetalleTransaccion[]) THEN
			SET Environment.DetalleTransaccion = InputRoot.XMLNSC.Error.DetalleTransaccion;
		END IF;
		
		IF EXISTS(Environment.DetalleTransaccion.MQMD_Main[]) THEN
			SET OutputRoot.MQMD = Environment.DetalleTransaccion.MQMD_Main;
			SET OutputLocalEnvironment.Destination.MQ.DestinationData.queueName = Environment.DetalleTransaccion.MQMD_Main.ReplyToQ;
		END IF;
	
		SET OutputRoot.XMLNSC.Error.lc = Environment.DetalleTransaccion.lc;
		SET OutputRoot.XMLNSC.Error.numTransaccion = Environment.DetalleTransaccion.numTransaccion;
		SET OutputRoot.XMLNSC.Error.codigoError = exceptionPrefix || InputRoot.XMLNSC.Error.codigoError;
		--Sólo si el error es debido a que el mensaje no cumple con el esquema se agregará el detalle del error en la validación
		IF InputRoot.XMLNSC.Error.errorEsquema = TRUE THEN
			SET OutputRoot.XMLNSC.Error.descripcionError = InputRoot.XMLNSC.Error.detalleError;
		END IF;
		SET OutputRoot.XMLNSC.Error.actor = InputRoot.XMLNSC.Error.actor;
		SET OutputRoot.XMLNSC.Error.fecha = InputRoot.XMLNSC.Error.fecha;
		RETURN TRUE;
	END;
END MODULE;
