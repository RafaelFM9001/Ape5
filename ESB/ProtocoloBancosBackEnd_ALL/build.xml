<?xml version="1.0" encoding="UTF-8"?>
<!--
SAT - Noviembre 2017
Oscar Daniel Jiménez Gutiérrez - Softtek
-->

<project basedir="." name="ProtocoloBancosValidarLineaCapturaBackEnd" default="Linux">
	<property file="build.properties" />
	<property name="applicationName" value="ProtocoloBancosValidarLineaCapturaBackEnd" />
	
	<target name="Linux" description="Compilation for Linux Environments">
		<property name="environment" value="Linux" />
		<property name="slash" value="/" />
		<property name="workspace" location="${basedir}${slash}.." />
		<property name="BARName" value="${applicationName}.bar" />
		<antcall target="compilation.main" />
	</target>
	
	<target name="compilation.main" description="Compilation tasks orchestration">
		<echo message="Starting compilation ${applicationName} for ${environment}..." />
		<antcall target="clean" />
		<antcall target="createbar" />
		<antcall target="configurebar" />
		<antcall target="deploybar" />
		<echo message="Script ended" />
	</target>

	<target name="clean" description="Delete current BAR">
		<echo message="Delete current BAR (${BARName})" />
		<delete file="${BARName}" />
	</target>

	<target name="createbar" description="Create Bar">
		<echo message="Creating BAR file: ${BARName}" />
		<echo message="${toolkit.installation}mqsicreatebar" />
		<echo message="-data ${workspace}" />
		<echo message="-b ${basedir}${slash}${BARName}" />
		<echo message="-cleanBuild" />
		<echo message="-a ${applicationName}"/>
		<echo message="-deployAsSource"/>

		<exec executable="${toolkit.installation}mqsicreatebar" spawn="false" logerror="false" failonerror="true" vmlauncher="false">
			<arg value="-data" />
			<arg value="${workspace}" />
			<arg value="-b" />
			<arg value="${basedir}${slash}${BARName}" />
			<arg value="-cleanBuild" />
			<arg value="-a" />
			<arg value="${applicationName}" />
			<arg value="-deployAsSource" /> 
		</exec>
		<echo message="Broker Archive file creation ended - ${BARName}"/>
	</target>
	
	<target name="configurebar" description="Configure Bar">
		<echo message="Creating BAR file: ${BARName}" />
		<echo message="${toolkit.installation}mqsiapplybaroverride" />
		<echo message="-b" />
		<echo message="${basedir}${slash}${BARName}" />
		<echo message="-p" />
		<echo message="-${basedir}${slash}dev_local.properties" />
		<echo message="-o"/>
		<echo message="${basedir}${slash}Local${BARName}" />
		<echo message="-r"/>

		<exec executable="${toolkit.installation}mqsiapplybaroverride" spawn="false" logerror="false" failonerror="true" vmlauncher="false">
			<arg value="-b" />
			<arg value="${basedir}${slash}${BARName}" />
			<arg value="-p" />
			<arg value="${basedir}${slash}dev_local.properties" />
			<arg value="-o" />
			<arg value="${basedir}${slash}Local${BARName}" />
			<arg value="-r" />
		</exec>
		<echo message="Broker Archive file configuration ended - Local${BARName}"/>
	</target>
	
	<target name="deploybar" description="Deploy Bar">
			<echo message="Deploying: Local${BARName}" />
			<echo message="C:\Program Files\IBM\MQSI\8.0.0.4\bin\mqsideploy" />
			<echo message="BRK01" />
			<echo message="-e" />
			<echo message="default" />
			<echo message="-a" />
			<echo message="${basedir}${slash}Local${BARName}" />

			<exec executable="C:\Program Files\IBM\MQSI\8.0.0.4\bin\mqsideploy" spawn="false" logerror="false" failonerror="true" vmlauncher="false">
				<arg value="BRK01" />
				<arg value="-e" />
				<arg value="default" />
				<arg value="-a" />
				<arg value="${basedir}${slash}Local${BARName}" />
			</exec>
			<echo message="Broker Archive file deploy ended - Local${BARName}"/>
		</target>
</project>