/*
*
* Autor: Oscar Daniel Jiménez Gutiérrez - Softtek
* Fecha de creación: 17 Enero 2018 Version: 1.0
*/


CREATE COMPUTE MODULE ThrowException_XMLValidation
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
		SET Environment.actor = 'BK';
		DECLARE countXMLValidationErrors INTEGER CARDINALITY(Environment.XMLValidationErrors.*[]);
		DECLARE validationDetail CHARACTER;
		DECLARE CRLF CHARACTER CAST( X'0D0A' AS CHARACTER CCSID 850);  --\r\n
		DECLARE i INTEGER 1;
		WHILE i <= countXMLValidationErrors DO
			IF i > 1 THEN
				SET validationDetail = validationDetail || CRLF || Environment.XMLValidationErrors.Error[i];
			ELSE
				SET validationDetail = Environment.XMLValidationErrors.Error[1];
			END IF;
			SET i = i + 1;
		END WHILE;
		THROW USER EXCEPTION MESSAGE(99) VALUES('Error en validación de esquema', validationDetail);
		RETURN FALSE;
	END;
END MODULE;
